function resourceTiming() {
    var all = performance.getEntriesByType("resource");
    return all.length;
}

window.reportSpeed = function(pids) {
  //pids[3] 为采样率，如上报率为1/1000,那么这里的值就为1000
  var url='//report.huatuo.qq.com/report.cgi?appid=20286&platform=unknown&speedparams=',
  s = 'flag1=' + pids[0] + '&flag2=' + pids[1] + '&flag3=' + pids[2] + '&flag5=' + pids[3] + '&1=' + (speed_load-speed_start) + '&2=' + (speed_all_load-speed_start);
  
  var imgSendTimePoint = new Image();
  imgSendTimePoint.src = url + encodeURIComponent(s);
};

window.tgaxSpeed = function(pids) {
//   var path = window.location.href;
//   var ifr = document.createElement('iframe');
//   ifr.src = path;
//   ifr.style = "display: none;";
//   ifr.onload = function() {
//       if (typeof(pgvMain) == 'function') pgvMain();
//   };
//   document.body.appendChild(ifr);

  var prevCount = 0, currCount = 0;
  var timer = setInterval(function() {
      currCount = resourceTiming();
      
      if( currCount == prevCount ) {
          speed_all_load = new Date();
          speed_all_load = speed_all_load-50;
          window.reportSpeed(pids);
          clearInterval( timer );
      }else {
          prevCount = currCount;
      }
  }, 50);
};